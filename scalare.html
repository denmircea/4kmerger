<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>4K Video Merger - GitHub Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/coi-serviceworker/0.1.7/coi-serviceworker.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; text-align: center; padding: 40px; }
        .container { max-width: 800px; margin: auto; background: #1e1e1e; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .drop-area { border: 2px dashed #333; padding: 40px; margin: 10px; border-radius: 15px; cursor: pointer; transition: 0.3s; flex: 1; }
        .drop-area:hover { border-color: #00d1b2; background: #252525; }
        .active { border-color: #00d1b2; background: rgba(0, 209, 178, 0.1); }
        .flex { display: flex; gap: 20px; margin-bottom: 20px; }
        button { background: #00d1b2; border: none; padding: 15px 40px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; }
        button:disabled { background: #444; cursor: not-allowed; }
        #progress-bar { width: 0%; height: 10px; background: #00d1b2; margin-top: 20px; border-radius: 5px; transition: 0.3s; }
    </style>
</head>
<body>

<div class="container">
    <h1>4K Video Merger</h1>
    <div class="flex">
        <div id="v-zone" class="drop-area">Trage Video (.webm)</div>
        <div id="a-zone" class="drop-area">Trage Audio (.mp3)</div>
    </div>
    <button id="start-btn">CONVERTEȘTE ÎN 4K</button>
    <div id="progress-container" style="background: #333; border-radius: 5px; margin-top: 20px; display:none;">
        <div id="progress-bar"></div>
    </div>
    <p id="status">Încarcă fișierele pentru a începe</p>
</div>

<script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    let vFile, aFile;

    const setup = (id, isVideo) => {
        const zone = document.getElementById(id);
        zone.onclick = () => {
            const i = document.createElement('input'); i.type = 'file';
            i.onchange = e => { vFile = isVideo ? e.target.files[0] : vFile; aFile = isVideo ? aFile : e.target.files[0]; zone.innerText = e.target.files[0].name; zone.classList.add('active'); };
            i.click();
        };
        zone.ondragover = e => e.preventDefault();
        zone.ondrop = e => { e.preventDefault(); const f = e.dataTransfer.files[0]; if(isVideo) vFile = f; else aFile = f; zone.innerText = f.name; zone.classList.add('active'); };
    };

    setup('v-zone', true); setup('a-zone', false);

    document.getElementById('start-btn').onclick = async () => {
        if(!vFile || !aFile) return alert("Lipsesc fișiere!");
        const btn = document.getElementById('start-btn');
        const status = document.getElementById('status');
        btn.disabled = true;
        document.getElementById('progress-container').style.display = 'block';

        if(!ffmpeg.isLoaded()) await ffmpeg.load();

        ffmpeg.setProgress(({ ratio }) => {
            document.getElementById('progress-bar').style.width = (ratio * 100) + '%';
            status.innerText = `Procesare: ${Math.round(ratio * 100)}%`;
        });

        ffmpeg.FS('writeFile', 'v.webm', await fetchFile(vFile));
        ffmpeg.FS('writeFile', 'a.mp3', await fetchFile(aFile));

        // Comanda pentru 4K
        await ffmpeg.run('-i', 'v.webm', '-i', 'a.mp3', '-vf', 'scale=3840:2160', '-shortest', 'out.webm');

        const data = ffmpeg.FS('readFile', 'out.webm');
        const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/webm' }));
        status.innerHTML = `<a href="${url}" download="video_4k.webm" style="color:#00d1b2">DESCARCĂ VIDEO 4K FINALIZAT</a>`;
        btn.disabled = false;
    };
</script>
</body>
</html>