<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>4K Video Merger - Fixed</title>
    
    <script>
        // Acest script for»õeazƒÉ Service Worker-ul sƒÉ ruleze din folderul curent
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./coi-serviceworker.js');
            });
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/coi-serviceworker/0.1.7/coi-serviceworker.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 50px; }
        .box { background: #1e1e1e; padding: 30px; border-radius: 15px; display: inline-block; border: 1px solid #333; }
        .status { padding: 10px; margin-bottom: 20px; border-radius: 5px; font-weight: bold; }
        .green { background: #1b4332; color: #74c69d; }
        .red { background: #431b1b; color: #ff8787; }
        .drop { border: 2px dashed #444; padding: 20px; margin: 10px; cursor: pointer; }
        button { background: #00d1b2; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        button:disabled { background: #444; color: #777; }
    </style>
</head>
<body>

<div class="box">
    <h2>4K Video Merger</h2>
    
    <div id="shield" class="status red">‚ö†Ô∏è STARE: Blocat (A»ôteptare Service Worker)</div>

    <div id="v-drop" class="drop">SelecteazƒÉ Video (.webm)</div>
    <div id="a-drop" class="drop">SelecteazƒÉ Audio (.mp3)</div>

    <button id="run-btn" disabled>PORNE»òTE 4K</button>
    <p id="info"></p>
</div>

<script>
    const shield = document.getElementById('shield');
    const btn = document.getElementById('run-btn');

    // Verificare activa
    if (window.crossOriginIsolated) {
        shield.innerText = "üõ°Ô∏è STARE: ACTIV (Gata de lucru)";
        shield.className = "status green";
        btn.disabled = false;
    } else {
        console.log("Se a»ôteaptƒÉ activarea SharedArrayBuffer...");
    }

    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    let v, a;

    const setup = (id, isV) => {
        document.getElementById(id).onclick = () => {
            let i = document.createElement('input'); i.type = 'file';
            i.onchange = e => { 
                if(isV) v = e.target.files[0]; else a = e.target.files[0];
                document.getElementById(id).innerText = "‚úÖ " + e.target.files[0].name;
            };
            i.click();
        };
    };
    setup('v-drop', true); setup('a-drop', false);

    btn.onclick = async () => {
        if(!v || !a) return alert("Pune ambele fisiere!");
        btn.disabled = true;
        document.getElementById('info').innerText = "Se proceseazƒÉ... dureazƒÉ c√¢teva minute.";
        
        if(!ffmpeg.isLoaded()) await ffmpeg.load();
        ffmpeg.FS('writeFile', 'v', await fetchFile(v));
        ffmpeg.FS('writeFile', 'a', await fetchFile(a));

        await ffmpeg.run('-i', 'v', '-i', 'a', '-vf', 'scale=3840:2160', '-shortest', 'out.webm');

        const data = ffmpeg.FS('readFile', 'out.webm');
        const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/webm' }));
        document.getElementById('info').innerHTML = `<a href="${url}" download="4k_video.webm" style="color:#00d1b2">DESCARCƒÇ VIDEO 4K</a>`;
    };
</script>
</body>
</html>
